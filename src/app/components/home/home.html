<div class="diary-container">
	<div class="diary-layout">
		<!-- Categories & Entries Sidebar -->
		<div class="entries-sidebar">
			<div class="sidebar-header">
				<h3>My Diary</h3>
				<div class="sidebar-actions">
					<button (click)="createNewEntry()" class="new-entry-btn">+ New Entry</button>
					<button (click)="clearAllData()" class="clear-data-btn" title="Clear all data and start fresh">üóëÔ∏è</button>
				</div>
			</div>

			<!-- Category Filter -->
			<div class="category-filter">
				<label for="categoryFilter">Filter by Category:</label>
				<select id="categoryFilter" [(ngModel)]="selectedCategory" (change)="onCategoryChange()" class="category-select">
					<option value="all">All Categories</option>
					<option *ngFor="let category of availableCategories" [value]="category.id">
						{{ category.name }}
					</option>
				</select>
			</div>

			<!-- Category Stats (Optional) -->
			<div class="category-stats" *ngIf="categoryStats.length > 0">
				<h4>Category Overview</h4>
				<div class="stats-grid">
					<!-- All Categories Option -->
					<div class="stat-item" 
						 [class.active]="selectedCategory === 'all'"
						 style="border-left-color: #9c27b0"
						 (click)="filterByCategory('all')"
						 title="Show all entries">
						<span class="stat-category">All Categories</span>
						<span class="stat-count">{{ getTotalEntriesCount() }}</span>
					</div>
					
					<!-- Individual Categories -->
					<div *ngFor="let stat of categoryStats" 
						 class="stat-item" 
						 [class.active]="selectedCategory === stat.category"
						 [style.border-left-color]="getCategoryColor(stat.category)"
						 (click)="filterByCategory(stat.category)"
						 title="Click to filter by {{ getCategoryName(stat.category) }}">
						<span class="stat-category">{{ getCategoryName(stat.category) }}</span>
						<span class="stat-count">{{ stat.entryCount }}</span>
					</div>
				</div>
			</div>
			
			<div class="entries-list" *ngIf="!isLoadingEntries">
				<div 
					*ngFor="let entry of getFilteredEntries()" 
					class="entry-item"
					[class.selected]="selectedEntryId === entry.uniqueId"
					(click)="selectEntry(entry.uniqueId)">
					<div class="entry-header">
						<span class="entry-category" [style.background-color]="getCategoryColor(entry.category)">
							{{ getCategoryName(entry.category) }}
						</span>
						<span class="entry-version">v{{ entry.version }}</span>
					</div>
					<div class="entry-preview">{{ getEntryPreview(entry.text) }}</div>
					<div class="entry-meta">
						<span class="entry-date">{{ formatDate(entry.updatedAt) }}</span>
						<div class="entry-tags" *ngIf="entry.tags && entry.tags.length > 0">
							<span *ngFor="let tag of entry.tags" class="tag">{{ tag }}</span>
						</div>
					</div>
				</div>
				
				<div *ngIf="getFilteredEntries().length === 0" class="no-entries">
					<div *ngIf="selectedCategory === 'all'">No entries yet. Create your first entry!</div>
					<div *ngIf="selectedCategory !== 'all'">No entries in this category yet.</div>
				</div>
			</div>
			
			<div *ngIf="isLoadingEntries" class="loading">Loading entries...</div>
		</div>

		<!-- Main Editor -->
		<div class="main-editor">
			<div class="editor-header">
				<h2>Diary Entry</h2>
				
				<!-- Category & Tags Section -->
				<div class="entry-metadata">
					<div class="metadata-row">
						<div class="category-selector">
							<label for="entryCategory">Category:</label>
							<select id="entryCategory" [(ngModel)]="currentCategory" (change)="onCategorySelectionChange()" class="category-select">
								<option *ngFor="let category of availableCategories" [value]="category.id">
									{{ category.name }}
								</option>
							</select>
						</div>
					</div>

					<div class="metadata-row">
						<div class="tags-section">
							<label>Tags:</label>
							<div class="tags-container">
								<span *ngFor="let tag of currentTags" class="tag-item">
									{{ tag }}
									<button (click)="removeTag(tag)" class="tag-remove">√ó</button>
								</span>
								<div class="tag-input-container">
									<input 
										type="text" 
										[(ngModel)]="newTag" 
										(keyup.enter)="addTag()"
										placeholder="Add tag..."
										class="tag-input">
									<button (click)="addTag()" class="tag-add-btn" *ngIf="newTag.trim()">+</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="diary-info" *ngIf="uniqueId">
				<p><strong>Entry ID:</strong> {{ uniqueId }}</p>
				<p><strong>Created:</strong> {{ createdAt | date:'medium' }}</p>
				<p><strong>Version:</strong> {{ currentVersion }}</p>
				<button (click)="manualSave()" class="version-btn">Save Now</button>
			</div>
			
			<textarea 
				[(ngModel)]="userText" 
				placeholder="Start writing your diary entry here..."
				class="diary-textarea"
				(blur)="onTextareaBlur()">
			</textarea>
			
			<div class="save-status" *ngIf="lastSavedText === userText && userText">
				‚úì Saved automatically
			</div>
			<div class="save-status pending" *ngIf="lastSavedText !== userText && userText">
				‚è≥ Changes pending...
			</div>
		</div>
	</div>
</div>
