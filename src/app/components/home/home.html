<div class="diary-container">
	<div class="diary-layout">
		<!-- Categories & Entries Sidebar -->
		<div class="entries-sidebar">
			<div class="sidebar-header">
				<h3>My Diary</h3>
				<div class="sidebar-actions">
					<button (click)="createNewEntry()" class="new-entry-btn">+ New Entry</button>
					<button (click)="clearAllData()" class="clear-data-btn" title="Clear all data and start fresh">üóëÔ∏è</button>
				</div>
			</div>

			<!-- Search Bar -->
			<div class="search-container">
				<div class="search-input-container">
					<input 
						type="text" 
						[(ngModel)]="searchTerm" 
						(input)="onSearchInput()"
						placeholder="Search entries, tags, categories..."
						class="search-input">
					<button 
						*ngIf="searchTerm" 
						(click)="clearSearch()" 
						class="search-clear-btn"
						title="Clear search">
						√ó
					</button>
				</div>

				<!-- Search Results Info -->
				<div class="search-info" *ngIf="isSearchMode">
					<span class="search-results-count">{{ getSearchResultsCount() }}</span>
				</div>

				<!-- Quick Search Buttons -->
				<div class="quick-search" *ngIf="!isSearchMode">
					<button (click)="searchToday()" class="quick-search-btn">Today</button>
					<button (click)="searchYesterday()" class="quick-search-btn">Yesterday</button>
					<button (click)="searchThisWeek()" class="quick-search-btn">This Week</button>
				</div>

				<!-- Advanced Search Filters -->
				<div class="search-filters" *ngIf="isSearchMode">
					<div class="filter-toggles">
						<label class="filter-toggle">
							<input type="checkbox" [(ngModel)]="searchFilters.content" (change)="toggleSearchFilter('content')">
							<span>Content</span>
						</label>
						<label class="filter-toggle">
							<input type="checkbox" [(ngModel)]="searchFilters.tags" (change)="toggleSearchFilter('tags')">
							<span>Tags</span>
						</label>
						<label class="filter-toggle">
							<input type="checkbox" [(ngModel)]="searchFilters.category" (change)="toggleSearchFilter('category')">
							<span>Category</span>
						</label>
					</div>

					<!-- Date Range Filter -->
					<div class="date-range-filter" *ngIf="searchFilters.dateRange">
						<input 
							type="date" 
							[(ngModel)]="searchFilters.startDate" 
							(change)="performSearch()"
							class="date-input">
						<span>to</span>
						<input 
							type="date" 
							[(ngModel)]="searchFilters.endDate" 
							(change)="performSearch()"
							class="date-input">
					</div>

					<button 
						(click)="toggleSearchFilter('dateRange')" 
						class="date-range-toggle"
						[class.active]="searchFilters.dateRange">
						üìÖ Date Range
					</button>
				</div>
			</div>

			<!-- Category Filter -->
			<div class="category-filter">
				<label for="categoryFilter">Filter by Category:</label>
				<select id="categoryFilter" [(ngModel)]="selectedCategory" (change)="onCategoryChange()" class="category-select">
					<option value="all">All Categories</option>
					<option *ngFor="let category of availableCategories" [value]="category.id">
						{{ category.name }}
					</option>
				</select>
			</div>

			<!-- Category Stats (Optional) -->
			<div class="category-stats" *ngIf="categoryStats.length > 0">
				<h4>Category Overview</h4>
				<div class="stats-grid">
					<!-- All Categories Option -->
					<div class="stat-item" 
						 [class.active]="selectedCategory === 'all'"
						 style="border-left-color: #9c27b0"
						 (click)="filterByCategory('all')"
						 title="Show all entries">
						<span class="stat-category">All Categories</span>
						<span class="stat-count">{{ getTotalEntriesCount() }}</span>
					</div>
					
					<!-- Individual Categories -->
					<div *ngFor="let stat of categoryStats" 
						 class="stat-item" 
						 [class.active]="selectedCategory === stat.category"
						 [style.border-left-color]="getCategoryColor(stat.category)"
						 (click)="filterByCategory(stat.category)"
						 title="Click to filter by {{ getCategoryName(stat.category) }}">
						<span class="stat-category">{{ getCategoryName(stat.category) }}</span>
						<span class="stat-count">{{ stat.entryCount }}</span>
					</div>
				</div>
			</div>
			
			<div class="entries-list" *ngIf="!isLoadingEntries">
				<!-- Pagination Info -->
				<div class="pagination-info">
					{{ getPaginationInfo() }}
				</div>

				<!-- Entries List -->
				<div 
					*ngFor="let entry of paginatedEntries" 
					class="entry-item"
					[class.selected]="selectedEntryId === entry.uniqueId"
					(click)="selectEntry(entry.uniqueId)">
					<div class="entry-header">
						<span class="entry-category" [style.background-color]="getCategoryColor(entry.category)">
							{{ getCategoryName(entry.category) }}
						</span>
						<span class="entry-version">v{{ entry.version }}</span>
					</div>
					<div class="entry-preview" [innerHTML]="highlightSearchTerm(getEntryPreview(entry.text))"></div>
					<div class="entry-meta">
						<span class="entry-date">{{ formatDate(entry.updatedAt) }}</span>
						<div class="entry-tags" *ngIf="entry.tags && entry.tags.length > 0">
							<span *ngFor="let tag of entry.tags" class="tag">{{ tag }}</span>
						</div>
					</div>
				</div>
				
				<!-- Pagination Controls -->
				<div class="pagination-container" *ngIf="totalPages > 1">
					<div class="pagination-controls">
						<!-- First/Previous buttons -->
						<button 
							(click)="goToFirstPage()" 
							[disabled]="currentPage === 1"
							class="pagination-btn"
							title="First page">
							&laquo;
						</button>
						<button 
							(click)="goToPreviousPage()" 
							[disabled]="currentPage === 1"
							class="pagination-btn"
							title="Previous page">
							&lsaquo;
						</button>

						<!-- Page numbers -->
						<button 
							*ngFor="let page of getPageNumbers()"
							(click)="goToPage(page)"
							[class.active]="page === currentPage"
							class="pagination-btn page-number">
							{{ page }}
						</button>

						<!-- Next/Last buttons -->
						<button 
							(click)="goToNextPage()" 
							[disabled]="currentPage === totalPages"
							class="pagination-btn"
							title="Next page">
							&rsaquo;
						</button>
						<button 
							(click)="goToLastPage()" 
							[disabled]="currentPage === totalPages"
							class="pagination-btn"
							title="Last page">
							&raquo;
						</button>
					</div>

					<!-- Page size selector -->
					<div class="page-size-selector">
						<label for="pageSize">Show:</label>
						<select id="pageSize" [(ngModel)]="pageSize" (change)="changePageSize(pageSize)" class="page-size-select">
							<option [value]="5">5 per page</option>
							<option [value]="10">10 per page</option>
							<option [value]="20">20 per page</option>
							<option [value]="50">50 per page</option>
						</select>
					</div>
				</div>
				
				<div *ngIf="paginatedEntries.length === 0 && !isLoadingEntries" class="no-entries">
					<div *ngIf="selectedCategory === 'all'">No entries yet. Create your first entry!</div>
					<div *ngIf="selectedCategory !== 'all'">No entries in this category yet.</div>
				</div>
			</div>
			
			<div *ngIf="isLoadingEntries" class="loading">Loading entries...</div>
		</div>

		<!-- Main Editor -->
		<div class="main-editor">
			<div class="editor-header">
				<h2>Diary Entry</h2>
				
				<!-- Category & Tags Section -->
				<div class="entry-metadata">
					<div class="metadata-row">
						<div class="category-selector">
							<label for="entryCategory">Category:</label>
							<select id="entryCategory" [(ngModel)]="currentCategory" (change)="onCategorySelectionChange()" class="category-select">
								<option *ngFor="let category of availableCategories" [value]="category.id">
									{{ category.name }}
								</option>
							</select>
						</div>
					</div>

					<div class="metadata-row">
						<div class="tags-section">
							<label>Tags:</label>
							<div class="tags-container">
								<span *ngFor="let tag of currentTags" class="tag-item">
									{{ tag }}
									<button (click)="removeTag(tag)" class="tag-remove">√ó</button>
								</span>
								<div class="tag-input-container">
									<input 
										type="text" 
										[(ngModel)]="newTag" 
										(keyup.enter)="addTag()"
										placeholder="Add tag..."
										class="tag-input">
									<button (click)="addTag()" class="tag-add-btn" *ngIf="newTag.trim()">+</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="diary-info" *ngIf="uniqueId">
				<p><strong>Entry ID:</strong> {{ uniqueId }}</p>
				<p><strong>Created:</strong> {{ createdAt | date:'medium' }}</p>
				<p><strong>Version:</strong> {{ currentVersion }}</p>
				<button (click)="manualSave()" class="version-btn">Save Now</button>
			</div>
			
			<textarea 
				[(ngModel)]="userText" 
				placeholder="Start writing your diary entry here..."
				class="diary-textarea"
				(blur)="onTextareaBlur()">
			</textarea>
			
			<div class="save-status" *ngIf="lastSavedText === userText && userText">
				‚úì Saved automatically
			</div>
			<div class="save-status pending" *ngIf="lastSavedText !== userText && userText">
				‚è≥ Changes pending...
			</div>
		</div>
	</div>
</div>
